let asambleaIniciada=!1;function porcentajeUnidos(){let conecciones=JSON.parse(sessionStorage.getItem("unidos"));let conectados=conecciones.filter(coneccion=>coneccion===!0).length;let desconectados=conecciones.length-conectados;let quorum=parseInt(conecciones.length/2)+1;let iniciarAsamblea=document.getElementById("iniciarAsamblea");let nuevoIniciarAsamablea=iniciarAsamblea.cloneNode(!0);iniciarAsamblea.parentNode.replaceChild(nuevoIniciarAsamablea,iniciarAsamblea);nuevoIniciarAsamablea.removeEventListener("click",iniciarAsambleaClickHandler);if(conectados>=quorum){nuevoIniciarAsamablea.addEventListener("click",async(e)=>{e.preventDefault();let request=await fetch(`/iniciarAsamblea?codigo=${localStorage.getItem("codigoAsamblea")}`);if(request.ok){location.href="asambleaIniciadaAdmin"}else{alert(await request.text())}})}else{nuevoIniciarAsamablea.addEventListener("click",(e)=>{e.preventDefault();insuficientesConecciones(quorum,conectados)})}
    let porcentajeConectados=conectados/conecciones.length*100;let porcentajeDesconectados=desconectados/conecciones.length*100;return[porcentajeDesconectados,porcentajeConectados]}
let iniciarAsambleaClickHandler=async()=>{let conecciones=JSON.parse(sessionStorage.getItem("unidos"));let conectados=conecciones.filter(coneccion=>coneccion===!0).length;let quorum=parseInt(conecciones.length/2)+1;if(conectados>=quorum){if(!asambleaIniciada){await fetch(`/iniciarAsamblea?codigo=${localStorage.getItem("codigoAsamblea")}`)}else alert("Ya se ha iniciado la asamblea")}else{insuficientesConecciones(quorum,conectados)}};let insuficientesConecciones=(quorum,conectados)=>{alert(`No se puede iniciar la asamblea, no hay suficientes usuarios conectados. Se necesitan ${quorum - conectados} usuarios m√°s conectados para iniciar la asamblea.`)}
let datos={labels:["Desconectados","Conectados"],datasets:[{data:porcentajeUnidos(),backgroundColor:['rgba(255, 0, 0, 0.5)','rgba(0, 255, 0, 0.5)'],borderColor:['rgba(255, 0, 0, 1)','rgba(0, 255, 0, 1)'],borderWidth:2}]};let opciones={responsive:!1,maintainAspectRatio:!1,title:{display:!0,text:'Porcentaje de personas conectadas y desconectadas',fontSize:20}};let ctx=document.getElementById('miGraficoDePastel').getContext('2d');let miGrafico=new Chart(ctx,{type:'pie',data:datos,options:opciones});setInterval(function(){miGrafico.data.datasets[0].data=porcentajeUnidos();miGrafico.update()},1000)